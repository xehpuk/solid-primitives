# https://moonrepo.dev/docs/config/tasks
$schema: "https://moonrepo.dev/schemas/tasks.json"

# Extend and inherit an external configuration file. Must be a valid HTTPS URL or file system path.
# extends: './shared/tasks.yml'

# File groups are a mechanism for grouping similar types of files within a project
# using file glob patterns. These groups are then used by tasks to calculate functionality like
# cache computation, affected files since last change, command line arguments, deterministic
# builds, and more.
#
# This setting requires a map, where the key is the file group name, and the value is a list of
# globs. Globs are relative to a project, even though they are defined globally. This enables
# enforcement of organizational patterns across all projects in the workspace.
fileGroups:
  # List of configuration files located within the project root.
  configs:
    - "*.{js,ts,json}"

  # List of non-test source files.
  sources:
    - "src/**/*"

  # List of non-source test files.
  tests:
    - "test/**/*"

  # # All static assets within the project.
  # # This may include styles, images, videos, etc.
  # assets:
  #   - "assets/**/*"
  #   - "images/**/*"
  #   - "static/**/*"
  #   - "**/*.{scss,css}"
  #   - "**/*.mdx"

# A task is an action that is ran within the context of a project, and wraps
# around an npm or system command. Tasks that are defined here and inherited by all projects
# within the workspace, but can be overridden per project.
#
# This setting requires a map, where the key is a unique name for the task,
# and the value is an object of task parameters.

tasks:
  # build the package with tsup
  build:
    command: "pnpm run build"
    inputs:
      - "src/**/*"
    outputs:
      - "dist"
    deps:
      - "^:build"
    env:
      # avoids printing the export fields by tsup-preset-solid
      CI: "true"

  # build the /dev playground page
  page:
    command: "vite build dev"
    inputs:
      - "src/**/*"
      - "dev/**/*"
      - "!dev/dist/**/*"
    outputs:
      - "dev/dist/**/*"
    deps:
      # building the package dependencies might change something on the page
      - "^:build"
